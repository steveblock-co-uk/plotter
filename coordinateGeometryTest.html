<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="coordinateGeometry.js"></script>
    <script type="text/javascript">
      function test() {
        var tester = new Tester(document.getElementById('testResults'));

        // solveQuadratic()
        tester.test('solveQuadratic(1, 0, 0)', '[0]');
        tester.test('solveQuadratic(1, 2, 0)', '[0, -2]');
        tester.test('solveQuadratic(1, 2, -8)', '[2, -4]');
        tester.test('solveQuadratic(1, 0, 1)', '[]');

        // calculateTriangleAngle()
        tester.test('calculateTriangleAngle(0, 1, 1)', '0');
        tester.test('calculateTriangleAngle(Math.sqrt(2), 1, 1)', 'Math.PI / 2');
        tester.test('calculateTriangleAngle(1, Math.sqrt(2), 1)', 'Math.PI / 4');
        tester.test('calculateTriangleAngle(1, Math.sqrt(3), 2)', 'Math.PI / 6');

        // getParameter()
        tester.test('getParameter(0, 2, 0)', '0');
        tester.test('getParameter(0, 2, 2)', '1');
        tester.test('getParameter(0, 2, 4)', '2');
        tester.test('getParameter(0, 2, -2)', '-1');

        // interpolate()
        tester.test('interpolate(0, 2, 0)', '0');
        tester.test('interpolate(0, 2, 1)', '2');
        tester.test('interpolate(0, 2, 2)', '4');
        tester.test('interpolate(0, 2, -1)', '-2');

        // toZeroTwoPi()
        tester.test('toZeroTwoPi(0)', '2 * Math.PI');
        tester.test('toZeroTwoPi(0)', '2 * Math.PI');
        tester.test('toZeroTwoPi(1)', '1');
        tester.test('toZeroTwoPi(2 * Math.PI)', '2 * Math.PI');
        tester.test('toZeroTwoPi(-1)', '2 * Math.PI - 1');
        tester.test('toZeroTwoPi(-2 * Math.PI)', '2 * Math.PI');

        // toZeroMinusTwoPi()
        tester.test('toZeroMinusTwoPi(0)', '-2 * Math.PI');
        tester.test('toZeroMinusTwoPi(1)', '1 - 2 * Math.PI');
        tester.test('toZeroMinusTwoPi(2 * Math.PI)', '-2 * Math.PI');
        tester.test('toZeroMinusTwoPi(-1)', '-1');
        tester.test('toZeroMinusTwoPi(-2 * Math.PI)', '-2 * Math.PI');

        // toMinusPlusPi()
        tester.test('toMinusPlusPi(0)', '0');
        tester.test('toMinusPlusPi(1)', '1');
        tester.test('toMinusPlusPi(2 * Math.PI)', '0');
        tester.test('toMinusPlusPi(-1)', '-1');
        tester.test('toMinusPlusPi(-2 * Math.PI)', '0');

        // Vector.toString()
        tester.test('new Vector(1, 2).toString()', '\'(1, 2)\'');

        // Vector.add()
        tester.test('new Vector(1, 2).add(new Vector(3, 4))', 'new Vector(4, 6)');
        tester.test('new Vector(1, 2).add(new Vector(-3, -4))', 'new Vector(-2, -2)');

        // Vector.subtract()
        tester.test('new Vector(1, 2).subtract(new Vector(3, 4))', 'new Vector(-2, -2)');
        tester.test('new Vector(1, 2).subtract(new Vector(-3, -4))', 'new Vector(4, 6)');

        // Vector.multiply()
        tester.test('new Vector(1, 2).multiply(2)', 'new Vector(2, 4)');
        tester.test('new Vector(1, 2).multiply(-2)', 'new Vector(-2, -4)');

        // Vector.magnitude()
        tester.test('new Vector(1 / Math.sqrt(2), 1 / Math.sqrt(2)).magnitude()', '1');
        tester.test('new Vector(1, 2).magnitude()', 'Math.sqrt(5)');

        // Vector.angle()
        tester.test('new Vector(1, Math.sqrt(3)).angle()', 'Math.PI / 3');
        tester.test('new Vector(1, -Math.sqrt(3)).angle()', '-Math.PI / 3');
        tester.test('new Vector(-1, Math.sqrt(3)).angle()', '2 * Math.PI / 3');
        tester.test('new Vector(-1, -Math.sqrt(3)).angle()', '- 2 * Math.PI / 3');

        // Vector.unit()
        tester.testApproxEquals('new Vector(1 / Math.sqrt(2), 1 / Math.sqrt(2)).unit()', 'new Vector(1 / Math.sqrt(2), 1 / Math.sqrt(2))');
        tester.testApproxEquals('new Vector(1, 2).unit()', 'new Vector(1 / Math.sqrt(5), 2 / Math.sqrt(5))');

        // Vector.unitNormal()
        tester.testApproxEquals('new Vector(1 / Math.sqrt(2), 1 / Math.sqrt(2)).unitNormal()', 'new Vector(-1 / Math.sqrt(2), 1 / Math.sqrt(2))');
        tester.testApproxEquals('new Vector(1, 2).unitNormal()', 'new Vector(-2 / Math.sqrt(5), 1 / Math.sqrt(5))');

        // Vector.dot()
        tester.test('new Vector(1, 2).dot(new Vector(1, 2))', '5');
        tester.test('new Vector(1, 2).dot(new Vector(2, -1))', '0');

        // Vector.cross()
        tester.test('new Vector(1, 2).cross(new Vector(1, 2))', '0');
        tester.test('new Vector(1, 2).cross(new Vector(-2, 1))', '5');
        tester.test('new Vector(1, 2).cross(new Vector(2, -1))', '-5');

        // Vector.rotate()
        tester.test('new Vector(1, 2).rotate(0)', 'new Vector(1, 2)');
        tester.testApproxEquals('new Vector(1, 2).rotate(Math.PI / 2)', 'new Vector(-2, 1)');
        tester.testApproxEquals('new Vector(1, 2).rotate(Math.PI)', 'new Vector(-1, -2)');
        tester.testApproxEquals('new Vector(1, 2).rotate(3 * Math.PI / 2)', 'new Vector(2, -1)');
        tester.testApproxEquals('new Vector(1, 2).rotate(2 * Math.PI)', 'new Vector(1, 2)');

        // PointOnCurve.toString()
        tester.test('new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 1).toString()', '\'[[(1, 2) -> (3, 4)] @ 1]\'');

        // PointOnCurve.equals()
        tester.test('new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 1).equals(new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 1))', 'true');
        tester.test('new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 1).equals(new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(5, 6)), 0.5))', 'false');

        // PointOnCurve.asVector()
        tester.test('new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 1).asVector()', 'new Vector(3, 4)');
        tester.test('new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(5, 6)), 0.5).asVector()', 'new Vector(3, 4)');

        // StraightLine.toString()
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).toString()', '\'[(1, 2) -> (3, 4)]\'');

        // StraightLine.equals()
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).equals(new StraightLine(new Vector(1, 2), new Vector(3, 4)))', 'true');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).equals(new StraightLine(new Vector(3, 4), new Vector(1, 2)))', 'false');

        // StraightLine.getPointAtParameter()
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).getPointAtParameter(-1)', 'new Vector(-1, 0)');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).getPointAtParameter(0)', 'new Vector(1, 2)');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).getPointAtParameter(0.5)', 'new Vector(2, 3)');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).getPointAtParameter(1)', 'new Vector(3, 4)');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).getPointAtParameter(2)', 'new Vector(5, 6)');

        // StraightLine.shiftOrthogonal()
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).shiftOrthogonal(-Math.sqrt(2))', 'new StraightLine(new Vector(2, 1), new Vector(4, 3))');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).shiftOrthogonal(0)', 'new StraightLine(new Vector(1, 2), new Vector(3, 4))');
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).shiftOrthogonal(Math.sqrt(2))', 'new StraightLine(new Vector(0, 3), new Vector(2, 5))');

        // StraightLine.getIntersectionsWithStraightLine()
        tester.test(
            'new StraightLine(new Vector(1, 2), new Vector(3, 4)).getIntersectionsWithStraightLine(new StraightLine(new Vector(1, 4), new Vector(3, 2)))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 0.5), other: new PointOnCurve(new StraightLine(new Vector(1, 4), new Vector(3, 2)), 0.5)}]');
        tester.test(
            'new StraightLine(new Vector(1, 2), new Vector(3, 4)).getIntersectionsWithStraightLine(new StraightLine(new Vector(3, 6), new Vector(5, 4)))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 1.5), other: new PointOnCurve(new StraightLine(new Vector(3, 6), new Vector(5, 4)), 0.5)}]');
        tester.test(
            'new StraightLine(new Vector(1, 2), new Vector(3, 4)).getIntersectionsWithStraightLine(new StraightLine(new Vector(1, 1), new Vector(3, 3)))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), Infinity), other: new PointOnCurve(new StraightLine(new Vector(1, 1), new Vector(3, 3)), -Infinity)}]');

        // StraightLine.getIntersectionsWithArc()
        tester.test(
            'new StraightLine(new Vector(0, 2), new Vector(2, 2)).getIntersectionsWithArc(new Arc(new Vector(1, 0), 1, 0, 0, false))',
            '[]');
        tester.test(
            'new StraightLine(new Vector(0, 2), new Vector(2, 2)).getIntersectionsWithArc(new Arc(new Vector(1, 1), 1, 0, 0, false))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 0.5), other: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 0.25)}]');
        tester.test(
            'new StraightLine(new Vector(0, 2), new Vector(2, 2)).getIntersectionsWithArc(new Arc(new Vector(1, 2), 1, 0, 0, false))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 1), other: new PointOnCurve(new Arc(new Vector(1, 2), 1, 0, 0, false), 0.5)}, {self: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 0), other: new PointOnCurve(new Arc(new Vector(1, 2), 1, 0, 0, false), 0)}]');

        // StraightLine.getIntersectionsWithCurve()
        tester.test(
            'new StraightLine(new Vector(1, 2), new Vector(3, 4)).getIntersectionsWithCurve(new StraightLine(new Vector(1, 4), new Vector(3, 2)))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(1, 2), new Vector(3, 4)), 0.5), other: new PointOnCurve(new StraightLine(new Vector(1, 4), new Vector(3, 2)), 0.5)}]');
        tester.test(
            'new StraightLine(new Vector(0, 2), new Vector(2, 2)).getIntersectionsWithCurve(new Arc(new Vector(1, 1), 1, 0, 0, false))',
            '[{self: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 0.5), other: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 0.25)}]');

        // StraightLine.delta()
        tester.test('new StraightLine(new Vector(1, 2), new Vector(3, 4)).delta()', 'new Vector(2, 2)');

        // TODO: Arc

        // Arc.getIntersectionsWithStraightLine()
        tester.test(
            'new Arc(new Vector(1, 0), 1, 0, 0, false).getIntersectionsWithStraightLine(new StraightLine(new Vector(0, 2), new Vector(2, 2)))',
            '[]');
        tester.test(
            'new Arc(new Vector(1, 1), 1, 0, 0, false).getIntersectionsWithStraightLine(new StraightLine(new Vector(0, 2), new Vector(2, 2)))',
            '[{self: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 0.25), other: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 0.5)}]');
        tester.test(
            'new Arc(new Vector(1, 2), 1, 0, 0, false).getIntersectionsWithStraightLine(new StraightLine(new Vector(0, 2), new Vector(2, 2)))',
            '[{self: new PointOnCurve(new Arc(new Vector(1, 2), 1, 0, 0, false), 0.5), other: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 1)}, {self: new PointOnCurve(new Arc(new Vector(1, 2), 1, 0, 0, false), 0), other: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 0)}]');

        // Arc.getIntersectionsWithArc()
        tester.test(
            'new Arc(new Vector(1, 1), 1, 0, 0, false).getIntersectionsWithArc(new Arc(new Vector(-2, 1), 1, 0, 0, false))',
            '[]');
        tester.test(
            'new Arc(new Vector(1, 1), 1, 0, 0, false).getIntersectionsWithArc(new Arc(new Vector(-1, 1), 1, 0, 0, false))',
            '[{self: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 0.5), other: new PointOnCurve(new Arc(new Vector(-1, 1), 1, 0, 0, false), 0)}]');
        tester.test(
            'new Arc(new Vector(1, 1), 1, 0, 0, false).getIntersectionsWithArc(new Arc(new Vector(0, 1), 1, 0, 0, false))',
            '[{self: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 1/3), other: new PointOnCurve(new Arc(new Vector(-1, 1), 1, 0, 0, false), 1/6)}, {self: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 2/3), other: new PointOnCurve(new Arc(new Vector(-1, 1), 1, 0, 0, false), 5/6)}]');

        // Arc.getIntersectionsWithCurve()
        tester.test(
            'new Arc(new Vector(1, 1), 1, 0, 0, false).getIntersectionsWithCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)))',
            '[{self: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 0.25), other: new PointOnCurve(new StraightLine(new Vector(0, 2), new Vector(2, 2)), 0.5)}]');
        tester.test(
            'new Arc(new Vector(1, 1), 1, 0, 0, false).getIntersectionsWithCurve(new Arc(new Vector(-1, 1), 1, 0, 0, false))',
            '[{self: new PointOnCurve(new Arc(new Vector(1, 1), 1, 0, 0, false), 0.5), other: new PointOnCurve(new Arc(new Vector(-1, 1), 1, 0, 0, false), 0)}]');
      }

      function areObjectsEqual(a, b) {
        if (typeof a.equals === 'function') {
          if (!a.equals(b)) {
            throw new Error('equals() method returned false');
          }
        } else if (typeof a != typeof b) {
          throw new Error('Types unequal: ' + typeof a + ', ' + typeof b);
        } else if (typeof a == 'object') {
          var properties = Object.getOwnPropertyNames(a);
          properties.concat(Object.getOwnPropertyNames(b));
          for (var i = 0; i < properties.length; ++i) {
            var property = properties[i];
            try {
              areObjectsEqual(a[property], b[property]);
            } catch(e) {
              throw new Error('Unequal property \'' + i + '\': {' + e.message + '}');
            }
          }
        } else if (typeof a == 'number') {
          if (Math.abs(a - b) > 0.0000000001) {
            throw new Error('Unequal values ' + a + ' and ' + b);
          }
        } else if (a !== b) {
          throw new Error('Unequal values ' + a + ' and ' + b);
        }
      }
      function createTextSpan(text) {
        var span = document.createElement('span');
        span.innerText = text;
        return span;
      }
      function createDiv(className) {
        var div = document.createElement('div');
        div.className = className;
        return div;
      }

      function Tester(resultsDiv) {
        this.resultsDiv_ = resultsDiv;
        this.resultsDiv_.innerHTML = '';
        this.resultsDiv_.appendChild(createTextSpan('Test results'));
      }
      Tester.prototype.testApproxEquals = function(a, b) {
        this.test(a + '.subtract(' + b + ').magnitude()', '0');
      };
      Tester.prototype.test = function(expressionString, resultString) {
        var actual = eval(expressionString);
        // Need to make sure the eval has a return value?!
        var expected = eval('foo = ' + resultString);
        var div = createDiv('test pass');
        div.appendChild(createTextSpan(expressionString));
        try {
          areObjectsEqual(expected, actual);
          div.appendChild(createTextSpan(' : ' + resultString));
        } catch (e) {
          console.log(e.message);
          div.appendChild(createTextSpan(' : Expected ' + resultString));
          div.appendChild(createTextSpan(' : Actual ' + actual));
          div.className = 'test fail';
        }
        this.resultsDiv_.appendChild(div);
      }
    </script>
    <style type="text/css">
      div.test {
        margin: 1px;
        border: 1px solid black;
        font-size: small;
      }
      div.pass {
        background-color: green;
      }
      div.fail {
        background-color: red;
      }
    </style>
  </head>
  <body onload="test();">
    <pre id="testResults"></pre>
  <body>
</html>
