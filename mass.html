<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="plotter.js"></script>
    <script type="text/javascript" src="who_mass_13weeks_boy.js"></script>
    <script type="text/javascript" src="who_mass_5years_boy.js"></script>
    <script type="text/javascript">
      function daniel() {
        var kMillisecondsPerDay = 1000 * 60 * 60 * 24;
        var kDaysPerMonth = 365.25 / 12;
        var kMillisecondsPerMonth = kMillisecondsPerDay * kDaysPerMonth;
        var kDaysPerWeek = 7;
        var kWeeksPerMonth = kDaysPerMonth / kDaysPerWeek;
        var kOuncesToGrams = 28.3495;
        var kExpectedMassGainPerDayKilos = 0.02;
        var kDisposableDiaperMassGrams = 22;
        var kReusableDiaperMassGrams = 80;
        var kReusableDiaperLargeMassGrams = 76 + 28;
        var kDressMassGrams = 92;
        var kOnePieceSuitMassGrams = 78;
        var kOnesieMassGrams = 50;
        var kShortsMassGrams = 48;
        var data = [
          {
            timestamp: '2014/08/27 21:00',
            scale: 'Hospital',
            totalMassGrams: 4105
          }, {
            timestamp: '2014/08/29 11:00',
            scale: 'Hospital',
            totalMassGrams: 3815
          }, {
            timestamp: '2014/08/29 18:00',
            scale: 'Hospital',
            totalMassGrams: 3790
          }, {
            timestamp: '2014/08/31 13:00',
            scale: 'Nurse',
            totalMassGrams: 3886 // Dubious!
          }, {
            timestamp: '2014/09/01 02:00',
            scale: 'ER',
            totalMassGrams: 3820
          }, {
            timestamp: '2014/09/02 16:00',
            scale: 'Doctor',
            totalMassGrams: 3880,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2014/09/04 11:48',
            totalMassGrams: 3910,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2014/09/05 15:30',
            totalMassGrams: 141.5 * kOuncesToGrams, // 8lbs 13.5oz,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/06 14:30',
            totalMassGrams: 142.1 * kOuncesToGrams, // 8lbs 14.1oz,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/08 11:40',
            scale: 'Doctor',
            totalMassGrams: 3970,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/08 11:50',
            totalMassGrams: 4080,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/08 12:00',
            totalMassGrams: 3990,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2014/09/08 13:40',
            totalMassGrams: 143.9 * kOuncesToGrams, // 8lbs 15.9oz,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/08 13:50',
            totalMassGrams: 142.9 * kOuncesToGrams, // 8lbs 14.9oz,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/09 14:30',
            totalMassGrams: 142.9 * kOuncesToGrams, // 8lbs 14.9oz,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/10 16:00',
            totalMassGrams: 145 * kOuncesToGrams, // 9lbs 1oz,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/11 16:00',
            totalMassGrams: 4114,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2014/09/12 13:30',
            scale: 'Doctor',
            totalMassGrams: 4050
          }, {
            timestamp: '2014/09/12 16:15',
            totalMassGrams: 4160,
            nonBabyMassGrams: kDisposableDiaperMassGrams + kDressMassGrams
          }, {
            timestamp: '2014/09/13 16:10',
            totalMassGrams: 4226,
            nonBabyMassGrams: kReusableDiaperMassGrams + kDressMassGrams
          }, {
            timestamp: '2014/09/15 12:20',
            totalMassGrams: 4308,
            nonBabyMassGrams: kReusableDiaperMassGrams + kDressMassGrams
          }, {
            timestamp: '2014/09/15 12:30',
            totalMassGrams: 4290,
            nonBabyMassGrams: kReusableDiaperMassGrams + kDressMassGrams
          }, {
            timestamp: '2014/09/16 15:00',
            totalMassGrams: 4354,
            nonBabyMassGrams: kReusableDiaperMassGrams + kDressMassGrams
          }, {
            timestamp: '2014/09/17 15:00',
            totalMassGrams: 4324,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/18 14:00',
            totalMassGrams: 4348,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/19 16:00',
            totalMassGrams: 4396,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/22 12:45',
            totalMassGrams: 4348,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/22 15:15',
            totalMassGrams: 4416,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/24 13:00',
            totalMassGrams: 4445,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/25 11:15',
            totalMassGrams: 4461,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/25 14:30',
            scale: 'Doctor',
            totalMassGrams: 4270,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2014/09/26 15:15',
            totalMassGrams: 157.6 * kOuncesToGrams, // 9lbs 13.6oz
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/27 12:40',
            totalMassGrams: 4486,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/29 16:15',
            totalMassGrams: 4522,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/09/30 16:00',
            totalMassGrams: 4538,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/01 16:30',
            totalMassGrams: 4580,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/02 17:00',
            totalMassGrams: 4578,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/03 14:30',
            totalMassGrams: 4634,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/04 14:30',
            totalMassGrams: 4632,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/07 18:30',
            totalMassGrams: 4714,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/09 17:00',
            totalMassGrams: 4760,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/10 16:45',
            totalMassGrams: 4810,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/14 17:30',
            totalMassGrams: 171.4 * kOuncesToGrams,  // 10lbs 11.4oz
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/16 18:45',
            totalMassGrams: 4916,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/18 16:45',
            totalMassGrams: 4976,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/20 17:00',
            totalMassGrams: 175.9 * kOuncesToGrams,  // 10lbs 15.9oz
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/23 18:30',
            totalMassGrams: 5116,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/24 16:00',
            totalMassGrams: 5090,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/10/27 17:20',
            totalMassGrams: 5112,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2014/10/30 14:50',
            totalMassGrams: 5040,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2014/11/01 14:15',
            totalMassGrams: 5276,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/03 16:00',
            totalMassGrams: 5294,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/05 13:45',
            totalMassGrams: 5308,
            nonBabyMassGrams: kDisposableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/07 13:45',
            totalMassGrams: 5368,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/10 18:30',
            totalMassGrams: 5404,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/12 18:00',
            totalMassGrams: 5434,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/14 18:30',
            totalMassGrams: 5488,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2014/11/17 15:00',
            totalMassGrams: 5320,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2014/11/18 18:00',
            totalMassGrams: 5520,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/20 18:30',
            totalMassGrams: 5610,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/22 17:00',
            totalMassGrams: 5544,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/24 19:00',
            totalMassGrams: 5715,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/11/26 18:45',
            totalMassGrams: 5688,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/12/01 16:00',
            totalMassGrams: 5790,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/12/03 18:45',
            totalMassGrams: 5836,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/12/06 16:15',
            totalMassGrams: 5940,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2014/12/10 13:45',
            totalMassGrams: 5972,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2014/12/12 15:00',
            totalMassGrams: 5810,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2015/01/05 08:45',
            totalMassGrams: 6330,
            nonBabyMassGrams: kDisposableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2015/01/08 16:00',
            totalMassGrams: 6270,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2015/01/16 15:00',
            totalMassGrams: 6630,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2015/01/23 16:00',
            totalMassGrams: 6770,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2015/01/30 09:45',
            totalMassGrams: 6685,
            nonBabyMassGrams: kDisposableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2015/01/30 16:00',
            totalMassGrams: 6610,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2015/02/06 14:45',
            totalMassGrams: 6970,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2015/02/14 11:45',
            totalMassGrams: 6920,
            nonBabyMassGrams: kDisposableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2015/02/23 14:45',
            totalMassGrams: 7175,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2015/02/27 14:45',
            totalMassGrams: 7050,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            scale: 'Three Bridges Mobile',
            timestamp: '2015/03/09 14:45',
            totalMassGrams: 7525,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2015/03/13 16:30',
            totalMassGrams: 7510,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnesieMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2015/03/25 13:00',
            totalMassGrams: 7350,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2015/04/10 13:00',
            totalMassGrams: 7985,
            nonBabyMassGrams: kReusableDiaperMassGrams + kOnePieceSuitMassGrams
          }, {
            timestamp: '2015/05/05 17:30',
            totalMassGrams: 8150,
            nonBabyMassGrams: kReusableDiaperLargeMassGrams + kOnesieMassGrams
          }, {
            timestamp: '2015/06/05 10:00',
            totalMassGrams: 8510,
            nonBabyMassGrams: kReusableDiaperLargeMassGrams
          }, {
            scale: 'Doctor',
            timestamp: '2015/06/05 13:00',
            totalMassGrams: 8450,
            nonBabyMassGrams: kReusableDiaperLargeMassGrams
          }, {
            timestamp: '2015/07/14 16:45',
            totalMassGrams: 8665,
            nonBabyMassGrams: kDisposableDiaperMassGrams + kShortsMassGrams
          }, {
            timestamp: '2015/08/10 09:55',
            totalMassGrams: 9065,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }, {
            timestamp: '2015/08/21 17:30',
            totalMassGrams: 9100,
            nonBabyMassGrams: kReusableDiaperMassGrams
          }, {
            timestamp: '2015/11/13 11:30',
            totalMassGrams: 9800,
            nonBabyMassGrams: kDisposableDiaperMassGrams
          }
        ];
        var startTimestamp = new Date(data[0].timestamp);
        var startMass = data[0].totalMassGrams;

        var scaleColors = {};
        var kThreeBridges = 'Three Bridges';
        var colors = ['blue', 'cyan', 'green', 'black', 'grey'];
        data.forEach(function(entry) {
          if (entry.scale && entry.scale !== kThreeBridges && !scaleColors[entry.scale]) {
            scaleColors[entry.scale] = colors[Object.keys(scaleColors).length % colors.length];
          }
        });
        scaleColors[kThreeBridges] = 'red';

        plot = new Plot(1400, 700);
        plot.setGridOn(true);
        plot.setHoldOn(true);
        document.body.appendChild(plot.canvas());

        plot.plot(
            data.map(function(entry) { return (new Date(entry.timestamp) - startTimestamp) / kMillisecondsPerMonth }),
            data.map(function(entry) { return (entry.totalMassGrams - (entry.nonBabyMassGrams ? entry.nonBabyMassGrams : 0)) / 1000 }),
            {
              lineColor: 'red',
              markers: data.map(function(entry) { return (!entry.scale || entry.scale === kThreeBridges) ? '.' : 'o'; }),
              markerColors: data.map(function(entry) { return scaleColors[entry.scale ? entry.scale : kThreeBridges]; })
            });

        var massDataRanges = plot.getAxisRanges();

        var percentiles = [1, 3, 5, 10, 15, 25, 50, 75, 85, 90, 95, 97, 99];
        var n = percentiles.length - 1;

        for (var i in percentiles) {
          var red = 255 * (n - i) / n;
          var green = 255 * i / n;
          plot.plot(
              who_mass_13weeks_boy.map(function(entry) { return entry.week / kWeeksPerMonth; }),
              who_mass_13weeks_boy.map(function(entry) { return entry['p' + percentiles[i]]; }),
              {lineColor: '#' + toHex(red, 2) + toHex(green, 2) + '00', lineStyle: ':'});
          var highResolutionLastWeek = who_mass_13weeks_boy[who_mass_13weeks_boy.length - 1].week;
          var lowResolutionFirstMonth = Math.ceil(highResolutionLastWeek / kWeeksPerMonth);
          plot.plot(
              who_mass_5years_boy.map(function(entry, index, array) {
                entry = index < lowResolutionFirstMonth ? array[lowResolutionFirstMonth] : entry;
                return entry.month;
              }),
              who_mass_5years_boy.map(function(entry, index, array) {
                entry = index < lowResolutionFirstMonth ? array[lowResolutionFirstMonth] : entry;
                return  entry['p' + percentiles[i]];
              }),
              {lineColor: '#' + toHex(red, 2) + toHex(green, 2) + '00', lineStyle: ':'});
        }

        var endTime = plot.getAxisRanges()[0].max();
        var startMass = (data[0].totalMassGrams - (data[0].nonBabyMassGrams ? data[0].nonBabyMassGrams : 0)) / 1000;
        plot.plot([0, endTime], [startMass, startMass], {lineColor: 'black', lineStyle: '--'});

        var startMassesKilos = [3.6, 3.7, 3.8];
        startMassesKilos.forEach(function(startMass) {
          plot.plot([0, endTime], [startMass, startMass + endTime * kDaysPerMonth * kExpectedMassGainPerDayKilos], {lineColor: 'blue', lineStyle: '--'});
        });

        plot.setAxisRanges(massDataRanges[0], massDataRanges[1]);
        plot.setAxisLabels('Age (months)', 'Mass (kg)');
      }

      function toHex(x, width) {
        var result = (Math.floor(x / 16) * 16).toString(16);
        while (result.length < width)
          result = '0' + result;
        return result;
      }
    </script>
  </head>
  <body onload="daniel();">
  <body>
</html>
